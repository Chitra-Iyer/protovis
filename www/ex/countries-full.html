<html>
  <head>
    <title>Choropleth Map</title>
    <link type="text/css" rel="stylesheet" href="ex.css?3.1"/>
    <script type="text/javascript" src="../protovis-r3.2.js"></script>
    <script type="text/javascript" src="countries.js"></script>
    <style type="text/css">
      #fig {
        width: 860px; height: 516px;
      }
    </style>
  </head>
  <body><div id="center"><div id="fig">
    <div>
      Projection:
      <select id="menu" onchange="geo.projection(this.value); vis.render();">
        <option value="none" selected>Identity projection</option> 
        <option value="mercator">Mercator projection</option> 
        <option value="gall-peters">Gall-Peters projection</option>
        <option value="sinusoidal">Sinusoidal projection</option>
        <option value="hammer">Hammer projection</option>
      </select>
    </div>
    <script type="text/javascript+protovis">
  // Generate a random value to visualize (for now).
  countries.forEach(function(c) c.value = (stats[c.code].area != 0)?stats[c.code].pop/(stats[c.code].area*10):0);

  // Note: the aspect ratio is 5/3 and can be rescaled.
  var w = 860, h = 516;
  var geo = pv.Geo.scale("identity").range({x:0, y:0}, {x:w, y:h});
  var col = pv.Scale.linear(0, 400).range("green", "red");
  
  var vis = new pv.Panel()
      .width(w)
      .height(h)
      .fillStyle("#EEF");

  var country = vis.add(pv.Panel)
      .data(countries);

  country.add(pv.Panel)
      .data(function(c) c.borders)
    .add(pv.Line)
      .data(function(l) l)
      .left(geo.x)
      .top(geo.y)
      .lineWidth(.5)
      .strokeStyle("white")
      .fillStyle(function(d,l,c) col(c.value))
      .title(function(d,l,c) c.name + ' (' + c.value.toFixed(2) + ' people/km^2)');
      
  /* Latitude ticks. */
  vis.add(pv.Panel)
      .data(geo.ticks.lat())
    .add(pv.Line)
      .data(function(b) b)
      .left(geo.x)
      .top(geo.y)
      .strokeStyle("#999")
      .lineWidth(.5);

  /* Longitude ticks. */
  vis.add(pv.Panel)
      .data(geo.ticks.lng())
    .add(pv.Line)
      .data(function(b) b)
      .left(geo.x)
      .top(geo.y)
      .strokeStyle("#999")
      .lineWidth(.5);

   var start = new Date();
   vis.render();
   var end = new Date;
   var out = document.getElementById('msg');
   out.innerHTML = "Render time: " + (end - start) + 'ms';
    
    </script>
    <div id="msg">Rendering...</div>
  </div></div></body>
</html>
