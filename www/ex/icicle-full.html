<html>
  <head>
    <title>Flare Icicle</title>
    <link rel="stylesheet" type="text/css" href="ex.css"/>
    <script type="text/javascript" src="../protovis-r3.2.js"></script>
    <script type="text/javascript" src="flare.js"></script>
    <style type="text/css">
      body {
        background: #222;
        color: #eee;
      }
      #fig {
        width: 1200px;
        height: 700px;
      }
    </style>
  </head>
  <body><div id="center"><div id="fig">
    <script type="text/javascript+protovis">

      function getNodePath(node) {
          var path = node.nodeName;
          var parentNode = node.parentNode;
          while(parentNode) {
              path = parentNode.nodeName + "." + path;
              parentNode = parentNode.parentNode;
          }
          return path + (node.firstChild ? "" : " (" + node.nodeValue + " bytes)");
      }

      function onNodeClick(node) {
          var path = node.nodeName;
          var parentNode = node.parentNode;
          while(parentNode) {
              path = parentNode.nodeName + "/" + path;
              parentNode = parentNode.parentNode;
          }
          top.location = "http://svn.prefuse.org/flare/trunk/flare/flare/src/" + path + (node.firstChild?"/":".as");
      }

      var vis = new pv.Panel()
          .width(1200)
          .height(600);

      vis.add(pv.Layout.Partition.Fill)
          .data(pv.dom(flare)
              .root("flare")
              .sort(function(a, b) pv.naturalOrder(a.nodeName, b.nodeName))
              .nodes())
          .orient("top")
          .size(Number)
        .add(pv.Bar)
          .fillStyle(function(n) n.firstChild ? "#aec7e8" : "#ff7f0e")
          .title(getNodePath)
          .event("click", onNodeClick)
        .anchor("center").add(pv.Label)
          .textAngle(-Math.PI / 2)
          .visible(function(n) n.dx > 10)
          .text(function(n) n.nodeName);

      vis.render();

    </script>
  </div></div></body>
</html>
