<html>
  <head>
    <title>Antibiotic Effectiveness</title>
    <script type="text/javascript" src="../protovis-r3.1.0.js"></script>
    <script type="text/javascript" src="antibiotics.js"></script>
  </head>
  <body>
    <script type="text/javascript+protovis">
      var h = 14, w = 8, c = 200;
      var vis = new pv.Panel().width(580).height(230);

      /* Sort by Penicillin's effectiveness, then Gram staining. */
      antibiotics.sort(function(a, b) {
          return (a.penicillin < b.penicillin)
              ? -1 : ((a.penicillin > b.penicillin)
              ? 1 : ((a.gram < b.gram)
                  ? 1 : ((a.gram > b.gram)
                  ? -1 : 0)));
        });

      vis.add(pv.Rule)
          .data(pv.range(antibiotics.length))
          .strokeStyle("rgba(0, 0, 0, .1)")
          .top(function(i) i * h + 10);

      vis.add(pv.Dot)
          .data(pv.blend(antibiotics.map(function(d) {
                var staining = d.gram;
                return [
                    { drug : "penicillin", gram : staining, mic : d.penicillin },
                    { drug : "streptomycin", gram : staining, mic : d.streptomycin },
                    { drug : "neomycin", gram : staining, mic : d.neomycin },
                  ];
              })))
          .shape(function(d) {
              switch (d.gram) {
                case "positive": return "square";
                case "negative": return "circle";
              }
            })
          .strokeStyle(function(d) {
              switch (d.drug) {
                case "penicillin": return "#036";
                case "streptomycin": return "#360";
                case "neomycin": return "#603";
              }
            })
          .left(function(d) {
              var x = w * Math.log(d.mic) + c / 2;
              switch (d.drug) {
                case "penicillin": return 0 + x;
                case "streptomycin": return c + x;
                case "neomycin": return 2 * c + x;
              }
            })
          .top(function(d) Math.floor(this.index / 3) * h + 10);

      vis.add(pv.Rule)
          .data(pv.range(3))
          .left(function(i) i * c + c / 2);

      vis.render();
    </script>
  </body>
</html>
