<html>
  <head>
    <title>PolarClock</title>
    <script type="text/javascript" src="../protovis-r3.1.0.js"></script>
    <style type="text/css">
      body {
        background: #222;
        margin: 0px;
        height: 100%;
        width: 100%;
        display: table;
      }
      center {
        display: table-cell;
        vertical-align: middle;
      }
      #label {
        position: absolute;
        bottom: 10px;
        right: 10px;
        font: 10px sans-serif;
        color: #999;
      }
      #label a {
        color: #ccc;
      }
    </style>
  </head>
  <body><center>
    <script type="text/javascript+protovis">
    var radius = 400 / 2;

    /* Generate the fields for the given date. */
    function fields() {
      var d = new Date();

      function days() {
        return 32 - new Date(d.getYear(), d.getMonth(), 32).getDate();
      }

      var second = (d.getSeconds() + d.getMilliseconds() / 1000) / 60;
      var minute = (d.getMinutes() + second) / 60;
      var hour = (d.getHours() + minute) / 24;
      var weekday = (d.getDay() + hour) / 7;
      var date = (d.getDate() - 1 + hour) / days();
      var month = (d.getMonth() + date) / 12;

      return [
          { value: second, index: .7, text: d.format("%S s") },
          { value: minute, index: .6, text: d.format("%M m") },
          { value: hour, index: .5, text: d.format("%H h") },
          { value: weekday, index: .3, text: d.format("%a") },
          { value: date, index: .2, text: d.format("%d d") },
          { value: month, index: .1, text: d.format("%b") },
        ];
    }

    var vis = new pv.Panel().width(400).height(400);

    vis.add(pv.Wedge)
        .data(fields)
        .left(radius)
        .bottom(radius)
        .innerRadius(function(d) radius * d.index)
        .outerRadius(function(d) radius * (d.index + .1))
        .startAngle(-Math.PI / 2)
        .angle(function(d) 2 * Math.PI * d.value)
        .fillStyle(function(d) "hsl(" + (360 * d.value - 180) + ", 50%, 50%)")
        .lineWidth(2)
        .strokeStyle("#222")
      .anchor("start").add(pv.Label)
        .font("bold 11px sans-serif")
        .textStyle("#fff")
        .textAlign("right")
        .textAngle(0)
        .textBaseline("middle")
        .text(function(d) d.text);

    vis.render(); // XXX needed for safari
    setInterval(function() vis.render(), 50);
    </script>
    <div id="label">
      Inspired by <a href="http://blog.pixelbreaker.com/polarclock/">pixelbreaker</a>.
    </div>
  </center></body>
</html>
