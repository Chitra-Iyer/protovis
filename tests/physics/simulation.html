<html>
  <head>
    <title>Simulation</title>
    <script type="text/javascript" src="../../protovis-d3.2.js"></script>
    <style type="text/css">

body {
  margin: 0;
  background: #222;
}

    </style>
  </head>
  <body>
    <script type="text/javascript+protovis">

var w = window.innerWidth,
    h = window.innerHeight,
    nodes = pv.range(200).map(function(i) {
      return {x: w * Math.random(),
              y: h * Math.random(),
              r: 2 + Math.random() * 12};
    });

var sim = pv.simulation(nodes)
    .force(pv.Force.charge(6))
    .constraint(pv.Constraint.distance(28).min(function(a, b) a.r + b.r));

/* Stablize initial positions by stepping and zeroing velocities. */
for (var i = 0; i < 10; i++) {
  sim.step();
  nodes.forEach(function(n) { n.px = n.x; n.py = n.y; });
}

var vis = new pv.Panel()
    .width(w)
    .height(h);

vis.add(pv.Dot)
    .data(nodes)
    .left(function(d) d.x)
    .top(function(d) d.y)
    .size(function(d) d.r * d.r)
    .strokeStyle(pv.ramp("steelblue", "brown").by(function(d) d.vx * d.vx + d.vy * d.vy));

vis.add(pv.Panel)
    .data(nodes)
  .add(pv.Line)
    .data(pv.range(2))
    .strokeStyle("white")
    .left(function(i, d) d.x + i * 10 * d.vx)
    .top(function(i, d) d.y + i * 10 * d.vy);

setInterval(function() {
  sim.step();
  vis.render();
}, 30);

    </script>
  </body>
</html>
