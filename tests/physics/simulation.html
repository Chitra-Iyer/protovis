<html>
  <head>
    <title>Simulation</title>
    <script type="text/javascript" src="../../protovis-d3.2.js"></script>
    <style type="text/css">

body {
  margin: 0;
  background: #222;
}

    </style>
  </head>
  <body>
    <script type="text/javascript+protovis">

var w = window.innerWidth,
    h = window.innerHeight,
    nodes = pv.range(200).map(function(i) {
      return {x: w / 2 * (Math.random() + .5),
              y: h / 2 * (Math.random() + .5),
              r: 2 + Math.random() * 12};
    });

var sim = pv.simulation(nodes);
sim.force(pv.Force.charge().constant(2));
sim.constraint(pv.Constraint.distance()
    .radius(50)
    .min(function(a, b) a.r + b.r));

var vis = new pv.Panel()
    .width(w)
    .height(h);

vis.add(pv.Dot)
    .data(nodes)
    .left(function(d) d.x)
    .top(function(d) d.y)
    .size(function(d) d.r * d.r)
    .strokeStyle(pv.ramp("steelblue", "brown").by(function(d) d.vx * d.vx + d.vy * d.vy));

vis.add(pv.Panel)
    .data(nodes)
  .add(pv.Line)
    .data(pv.range(2))
    .strokeStyle("white")
    .left(function(i, d) d.x + i * 10 * d.vx)
    .top(function(i, d) d.y + i * 10 * d.vy);

vis.render();

setInterval(function() {
  sim.step();
  vis.render();
}, 30);

    </script>
  </body>
</html>
